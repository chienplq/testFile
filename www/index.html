<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
        <title>Blank App</title>
    </head>
    <body>
        <script type="text/javascript" src="cordova.js"></script>
		<script type="text/javascript">
		
		document.addEventListener("deviceready", onDeviceReady, false);
	
    function onDeviceReady() {
			document.getElementById("inputFileNameToSaveAs").onclick=saveTextAsFile();
			document.getElementById("loadFileAsText").onclick=loadFileAsText();
    }



	</script>
	<table>
 <tr><td>Text to Save:</td></tr>
 <tr>
  <td colspan="3">
   <textarea id="inputTextToSave" style="width:250px;height:125px"></textarea>
  </td>
 </tr>
  <tr>
  <td>Select a File to Load:</td>
  <td><input type="file" id="fileToLoad"></td>
  <td><button onclick="loadFileAsText()">Load Selected File</button><td>
 </tr>
 <tr>
  <td>--</td>
  <td>--</td>
  <td><button onclick="saveTextAsFile()">Save Text to File</button></td>
 </tr>

</table>

<script type='text/javascript'>

 function saveTextAsFile() {  

 window.requestFileSystem(window.PERSISTENT, 1024*1024*10, gotFS, fail);
 
}    
    function gotFS(fileSystem) {
        fileSystem.root.getFile("readme.txt", {create: true, exclusive: false}, gotFileEntry, fail);
    }

    function gotFileEntry(fileEntry) {
        fileEntry.createWriter(gotFileWriter, fail);
    }

    function gotFileWriter(writer) {
        writer.onwriteend = function(evt) {
            console.log("contents of file now 'some sample text'");
            writer.truncate(11);  
            writer.onwriteend = function(evt) {
                console.log("contents of file now 'some sample'");
                writer.seek(4);
                writer.write(" different text");
                writer.onwriteend = function(evt){
                    console.log("contents of file now 'some different text'");
                }
            };
        };
        writer.write("some sample text");
    }

    function fail(error) {
        console.log(error.code);
    }

  

    function loadFileAsText() {
        var fileToLoad = document.getElementById("fileToLoad").files[0];

        var fileReader = new FileReader();
        fileReader.onload = function (fileLoadedEvent) {
            var textFromFileLoaded = fileLoadedEvent.target.result;
            document.getElementById("inputTextToSave").value = textFromFileLoaded;
        };
        fileReader.readAsText(fileToLoad, "UTF-8");
    }

</script>
	
    </body>
</html>
